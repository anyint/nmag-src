# Nmag micromagnetic simulator
# Copyright (C) 2011 University of Southampton
# Hans Fangohr, Thomas Fischbacher, Matteo Franchin and others
#
# WEB:     http://nmag.soton.ac.uk 
# CONTACT: nmag@soton.ac.uk
#
# AUTHOR(S) OF THIS FILE: Matteo Franchin
# LICENSE: GNU General Public License 2.0
#          (see <http://www.gnu.org/licenses/>)

SHELL=@BASH@

.PHONY: all build-bin clean

NSIM_EXECS=nsim nmeshpp ncol nmagpp nmeshimport
all: nsim-raw $(NSIM_EXECS)

# Rule to make executables from the corresponding .in files
%: %.in
	. ./root.inc && \
	 sed -e 's|\$$NMAGBINDIR\$$|'"$$NMAG_BIN"'|g' $< | sed -e 's|^#!/bin/bash|#!@BASH@|' > $@ || rm $@
	 chmod u+x $@

nsim-raw: nsim-raw.in root.inc
	. ./root.inc && \
	sed -e 's|\$$NMAGROOTDIR\$$|'"$$NMAG_ROOT"'|g' nsim-raw.in > $@ || rm $@
	chmod u+x $@

nsim: nsim.in root.inc nsim-raw

nmeshpp: nmeshpp.in root.inc nsim-raw

ncol: ncol.in root.inc nsim-raw

nmagpp: nmagpp.in root.inc nsim-raw

nmeshimport: nmeshimport.in root.inc nsim-raw

root.inc:
	echo "# NMAG_BIN should be set to the Nmag bin directory." > root.inc && \
	echo "NMAG_BIN=`pwd`" >> root.inc && \
	echo "NMAG_ROOT=`cd .. && pwd`" >> root.inc

build-bin:
	rm -f root.inc
	$(MAKE)

clean:
	rm -f nsim-raw root.inc $(NSIM_EXECS)

